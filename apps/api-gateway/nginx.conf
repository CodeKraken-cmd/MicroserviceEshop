events {}
http {
  limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
  server {
    listen 80;
    add_header Access-Control-Allow-Origin $http_origin always;
    add_header Access-Control-Allow-Credentials true always;
    add_header Access-Control-Allow-Methods GET,POST,PUT,PATCH,DELETE,OPTIONS always;
    add_header Access-Control-Allow-Headers Authorization,Content-Type,* always;
    if ($request_method = OPTIONS) { return 204; }

    location /api/auth/      { limit_req zone=api burst=20 nodelay; proxy_pass http://auth:8000/; }
    location /api/catalog/   { limit_req zone=api burst=50 nodelay; proxy_pass http://catalog:8000/; }
    location /api/listings/  { limit_req zone=api burst=50 nodelay; proxy_pass http://listings:8000/; }
    location /api/cart/      { limit_req zone=api burst=50 nodelay; proxy_pass http://cart:8000/; }
    location /api/order/     { limit_req zone=api burst=20 nodelay; proxy_pass http://order:8000/; }
    location /api/payment/   { limit_req zone=api burst=20 nodelay; proxy_pass http://payment:8000/; }
    location /api/reviews/   { limit_req zone=api burst=50 nodelay; proxy_pass http://reviews:8000/; }
    location /api/auctions/  { limit_req zone=api burst=50 nodelay; proxy_pass http://auctions:8000/; }
    location /api/rfq/       { limit_req zone=api burst=20 nodelay; proxy_pass http://rfq:8000/; }
    location /api/search/    { limit_req zone=api burst=50 nodelay; proxy_pass http://search:8000/; }
  }
}
